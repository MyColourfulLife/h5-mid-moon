<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    html,body{
      margin: 0;
      padding: 0;
      font-size: 10px;
      overflow: hidden;
    }
    #box{
      width: 100%;
      height: 100%;
    }
    #dm{
      width: 100%;
      height: 90vh;
      background: #E8F1F5;
    }
    #dm span{
      width: auto;
      height: 3rem;
      font-size: 2rem;
      line-height: 2rem;
      position: absolute;
      white-space: nowrap;
    }
    #idDom{
      width: 100%;
      height: 10vh;
      background: #666;
      position: absolute;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #content{
      width: 50rem;
      height: 10vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .title{
      font-size: 2.2rem;
      color: #fff;
      line-height: #ccc
    }
    .text{
      width: 30rem;
      height: 2.5rem;
      border: none;
      border-radius: .5rem;
      font-size: 1.4rem;
      padding: 0 1rem;
      margin: 0 .5rem;    /*三个元素的间距*/
    }
    .btn{
      width: 6rem;
      height: 3rem;
      border: none;
      background: #f00;
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="box" id="box">
    <div id="dm"></div>

    <div class="idDom" id="idDom">
      <div id="content">
        <p class="title">吐槽:</p>
        <input type="text" class="text" id="text" placeholder="请输入你想说的话~~"/>
        <button type="button" class="btn" id="btn">发射!</button>
      </div>
    </div>
  </div>
</body>
<script>
    // 初始时间为空
  var timer = null;
//   获取发射按钮
  var btn = document.getElementById('btn');
//   绑定事件
  btn.onclick = function(){
    addBarrage();
  }
//   按下回车键 触发事件
  document.onkeydown = function(evt){
    var event = evt || window.event;
    if(event.keyCode == 13){
      addBarrage();
    }
  }
//   颜色
  var colors = ['#2C3E50','#FF0000','#1E87F0','#7AC84B','#FF7F00','#9B39F4','#FF69B4'];
//   添加弹幕
  function addBarrage(){
    //   清除时间间隔
    clearInterval(timer);
    // 获取用户的内容
    var text = document.getElementById('text').value;  //获取用户输入的值
    // 将用户输入框内容清空
    document.getElementById('text').value = '';
    // 生成随机数
    var index = parseInt(Math.random() * 7);  //生成一个0~6的随机数
    // 获取屏幕宽高
    var screenW = window.innerWidth;
    var screenH = dm.offsetHeight;   //获取当前屏幕高度
    var max = Math.floor(screenH / 40);
    var height = 10 + 40 * (parseInt(Math.random() * (max + 1)) - 1);
    //在 box 中插入弹幕
    // 创建span标签
    var span = document.createElement('span');
    // 设置起始位置 颜色 文本
    span.style.left = screenW +'px';
    span.style.top = height +'px';
    span.style.color = colors[index];
    span.innerHTML = text;
    // 将弹幕加入到弹幕框
    var dmDom = document.getElementById('dm');
    dmDom.appendChild(span);
    // 启动计时器
    timer = setInterval(move,10);
  }
  function move(){
    var arr= [];
    // 获取所有的弹幕span
    var oSpan = document.getElementsByTagName('span');
    for(var i = 0;i < oSpan.length;i++){
        // 保存所有的左偏移
      arr.push(oSpan[i].offsetLeft);
    //   让每个位移 减少2
      arr[i] -= 2
    //   更新标签的left值
      oSpan[i].style.left = arr[i]+'px';
    //   如果到头了 就移除这个span
      if (arr[i] < -oSpan[i].offsetWidth) {
        var dmDom = document.getElementById('dm');
        dmDom.removeChild(dmDom.childNodes[0]);
      }
    }
  }
</script>
</html>